"use strict";var path=require("path"),webpack=require("webpack"),merge=require("webpack-merge"),cleanWebpackPlugin=require("clean-webpack-plugin"),CopyWebpackPlugin=require("copy-webpack-plugin"),HtmlWebpackPlugin=require("html-webpack-plugin"),ScriptExtHtmlWebpackPlugin=require("script-ext-html-webpack-plugin"),MiniCssExtractPlugin=require("mini-css-extract-plugin"),OptimizeCSSAssetsPlugin=require("optimize-css-assets-webpack-plugin"),UglifyJsPlugin=require("uglifyjs-webpack-plugin"),utils=require("../utils"),config=require(utils.rootPath("env.param.config")),baseWebpackConfig=require("../basic/webpack.base.conf");function resolve(e){return path.join(__dirname,"..",e)}var env=require(utils.rootPath("env.config"))["testing"===process.env.NODE_ENV?"test_env":"prod_env"],seen=new Set,nameLength=4,prodWebpackConfig=merge(baseWebpackConfig,{mode:"production",module:{},devtool:!!config.build.prodJsSourceMap&&config.build.devtool,output:{path:config.build.assetsRoot,filename:utils.assetsPath("js/[name].[chunkhash:8].js"),chunkFilename:utils.assetsPath("js/[name].[chunkhash:8].js")},plugins:[new webpack.DefinePlugin({"process.env":env}),new cleanWebpackPlugin(["dist"],{root:utils.rootPath(""),verbose:!0,dry:!1}),new MiniCssExtractPlugin({filename:utils.assetsPath("css/[name].[contenthash:8].css"),chunkFilename:utils.assetsPath("css/[name].[contenthash:8].css")}),new HtmlWebpackPlugin({filename:"testing"===process.env.NODE_ENV?"index.html":config.build.index,template:"index.html",inject:!0,favicon:config.build.favicon,minify:{removeComments:!0,collapseWhitespace:!0,removeAttributeQuotes:!0},chunksSortMode:"dependency"}),new ScriptExtHtmlWebpackPlugin({inline:/runtime\..*\.js$/}),new webpack.NamedChunksPlugin(function(e){if(e.name)return e.name;var n=Array.from(e.modulesIterable);if(1<n.length){for(var i=require("hash-sum")(n.map(function(e){return e.id}).join("_")),s=nameLength;seen.has(i.substr(0,s));)s++;return seen.add(i.substr(0,s)),"chunk-"+i.substr(0,s)}return n[0].id}),new webpack.HashedModuleIdsPlugin,new CopyWebpackPlugin([{from:utils.rootPath("./static"),to:config.build.assetsSubDirectory,ignore:[".*"]}])],optimization:{splitChunks:{chunks:"all",cacheGroups:{libs:{name:"chunk-libs",test:/[\\/]node_modules[\\/]/,priority:10,chunks:"initial"},elementUI:{name:"chunk-elementUI",priority:20,test:/[\\/]node_modules[\\/]element-ui[\\/]/},commons:{name:"chunk-commons",test:resolve("packages/components"),minChunks:3,priority:5,reuseExistingChunk:!0}}},runtimeChunk:"single",minimizer:[new UglifyJsPlugin({uglifyOptions:{mangle:{safari10:!0}},sourceMap:config.build.prodJsSourceMap,cache:!0,parallel:!0}),new OptimizeCSSAssetsPlugin]}});if(config.build.productionGzip){var CompressionWebpackPlugin=require("compression-webpack-plugin");prodWebpackConfig.plugins.push(new CompressionWebpackPlugin({filename:"[path].gz[query]",algorithm:"gzip",test:new RegExp("\\.("+config.build.productionGzipExtensions.join("|")+")$"),threshold:10240,minRatio:.8}))}if(config.build.bundleAnalyzerReport){var BundleAnalyzerPlugin=require("webpack-bundle-analyzer").BundleAnalyzerPlugin;prodWebpackConfig.plugins.push(new BundleAnalyzerPlugin)}module.exports=prodWebpackConfig;